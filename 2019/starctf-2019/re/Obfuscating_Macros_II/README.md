# Obfuscating Macros II
It is very obvious that the binary is obfuscated so that many simple operations are wrapped as functions. After some observation we can find that some const nums are encrypted and the function at 0x4040a2 will decrypt them while running. To make it more plain, we patch the binary and remove the reference to sub\_4040a2(as show in partical\_deobf.py).

Then more reversing tells us that functions at 0x4045CC and 0x40456A both get a value pointer by the key in the hash map. The hash map maps nums(let's name them "code id") to code segments. And there are two stacks initialized by the function at 0x4044BE. One stores code id, which is used to get the actual control flow, and the other one stores temporary values while encrypting the input data. The function at 0x40459A can push data into the stack, the function at 0x404634 can get the data at the top of the stack and the funciton at 0x404618 can pop the data at the top out of the stack(seems no return value). Besides statical analysis, we set breakpoints at every code segment and run the program to observe its behaviors. Finally we make it and get the flag by the script solve.py
